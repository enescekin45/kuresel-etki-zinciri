<!DOCTYPE html>
<html>
<head>
    <title>Test JS API Call</title>
</head>
<body>
    <h1>Test JS API Call</h1>
    <button id="test-btn">Test API Call</button>
    <div id="result"></div>

    <script>
        document.getElementById('test-btn').addEventListener('click', async function() {
            try {
                console.log('Making API request to:', '/Küresel/api/products?search=Organik');
                
                const response = await fetch('/Küresel/api/products?search=Organik');
                
                console.log('Response status:', response.status);
                console.log('Response headers:', [...response.headers.entries()]);
                
                // Check if response is OK
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                // Get response text first to check what we're getting
                const responseText = await response.text();
                
                console.log('Raw response text:', responseText);
                
                // Check if response is empty
                if (!responseText || responseText.trim() === '') {
                    throw new Error('Sunucudan boş yanıt alındı. Lütfen daha sonra tekrar deneyin.');
                }
                
                // Check if response is HTML (error page) instead of JSON
                if (responseText.trim().startsWith('<')) {
                    throw new Error('Sunucudan geçersiz yanıt alındı. API erişiminde sorun oluştu.');
                }
                
                // Try to parse JSON
                let result;
                try {
                    result = JSON.parse(responseText);
                    console.log('Parsed JSON:', result);
                    document.getElementById('result').innerHTML = '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
                } catch (jsonError) {
                    console.error('Invalid JSON response:', responseText);
                    throw new Error('Sunucudan geçersiz yanıt alındı. Lütfen daha sonra tekrar deneyin.');
                }
                
            } catch (error) {
                console.error('Search error:', error);
                document.getElementById('result').innerHTML = '<p style="color: red;">Error: ' + error.message + '</p>';
            }
        });
    </script>
</body>
</html>