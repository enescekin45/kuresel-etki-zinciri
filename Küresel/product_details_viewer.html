<!DOCTYPE html>
<html>
<head>
    <title>Product Details Viewer</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background-color: #f5f5f5; 
            color: #333;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background-color: white; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        }
        h1, h2, h3 { 
            color: #2c3e50; 
        }
        .product-header { 
            display: flex; 
            gap: 20px; 
            margin-bottom: 30px; 
            padding-bottom: 20px; 
            border-bottom: 1px solid #eee;
        }
        .product-image { 
            flex: 0 0 300px; 
        }
        .product-image img { 
            width: 100%; 
            height: 300px; 
            object-fit: cover; 
            border-radius: 8px;
        }
        .product-info { 
            flex: 1; 
        }
        .product-info h1 { 
            margin-top: 0; 
        }
        .tabs { 
            display: flex; 
            border-bottom: 1px solid #ddd; 
            margin-bottom: 20px; 
        }
        .tab-button { 
            padding: 12px 24px; 
            background-color: #f8f9fa; 
            border: 1px solid #ddd; 
            border-bottom: none; 
            cursor: pointer; 
            margin-right: 5px; 
            border-radius: 5px 5px 0 0;
        }
        .tab-button.active { 
            background-color: #007bff; 
            color: white; 
        }
        .tab-content { 
            display: none; 
            padding: 20px; 
            border: 1px solid #ddd; 
            border-top: none; 
            border-radius: 0 0 5px 5px;
        }
        .tab-content.active { 
            display: block; 
        }
        .info-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 15px; 
        }
        .info-item { 
            background-color: #f8f9fa; 
            padding: 15px; 
            border-radius: 5px;
        }
        .info-item strong { 
            display: block; 
            margin-bottom: 5px; 
            color: #495057;
        }
        .supply-chain-steps { 
            display: flex; 
            flex-direction: column; 
            gap: 15px; 
        }
        .supply-chain-step { 
            display: flex; 
            gap: 15px; 
            padding: 15px; 
            background-color: #f8f9fa; 
            border-radius: 5px;
        }
        .step-icon { 
            font-size: 24px; 
            flex: 0 0 40px; 
            text-align: center;
        }
        .step-details { 
            flex: 1; 
        }
        .impact-scores-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); 
            gap: 15px; 
        }
        .impact-score-card { 
            background-color: #f8f9fa; 
            padding: 15px; 
            border-radius: 5px; 
            text-align: center;
        }
        .impact-score-value { 
            font-size: 24px; 
            font-weight: bold; 
            color: #007bff;
        }
        .certificates-list { 
            display: flex; 
            flex-direction: column; 
            gap: 15px; 
        }
        .certificate-card { 
            padding: 15px; 
            background-color: #f8f9fa; 
            border-radius: 5px;
        }
        .search-section { 
            margin-bottom: 30px; 
            padding: 20px; 
            background-color: #e9ecef; 
            border-radius: 8px;
        }
        .search-box { 
            width: 100%; 
            padding: 12px; 
            font-size: 16px; 
            border: 1px solid #ccc; 
            border-radius: 4px; 
            margin: 10px 0;
        }
        button { 
            padding: 12px 24px; 
            margin: 5px; 
            cursor: pointer; 
            background-color: #007bff; 
            color: white; 
            border: none; 
            border-radius: 4px; 
            font-size: 16px;
        }
        button:hover { 
            background-color: #0056b3;
        }
        .loading { 
            text-align: center; 
            padding: 20px;
        }
        .error { 
            background-color: #f8d7da; 
            color: #721c24; 
            padding: 15px; 
            border-radius: 5px; 
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Product Details Viewer</h1>
        
        <div class="search-section">
            <h2>Search for a Product</h2>
            <input type="text" id="product-search" class="search-box" placeholder="Enter product code, barcode, or name">
            <button onclick="searchProduct()">üîç Search</button>
            <button onclick="loadSampleProduct()">üìã Load Sample Product</button>
        </div>
        
        <div id="product-details-container">
            <div class="loading">Enter a product code, barcode, or name to search for product details</div>
        </div>
    </div>

    <script>
        async function searchProduct() {
            const searchTerm = document.getElementById('product-search').value.trim();
            if (!searchTerm) {
                alert('Please enter a search term');
                return;
            }
            
            const container = document.getElementById('product-details-container');
            container.innerHTML = '<div class="loading">Searching for product...</div>';
            
            try {
                // Search for the product
                const searchResponse = await fetch(`/K√ºresel/api/products?search=${encodeURIComponent(searchTerm)}`);
                const searchResult = await searchResponse.json();
                
                if (!searchResult.success || searchResult.data.products.length === 0) {
                    container.innerHTML = `<div class="error">No products found for "${searchTerm}"</div>`;
                    return;
                }
                
                // Get the first product's UUID
                const productUuid = searchResult.data.products[0].uuid;
                
                // Load the product details
                await loadProductDetails(productUuid);
                
            } catch (error) {
                container.innerHTML = `<div class="error">Error searching for product: ${error.message}</div>`;
            }
        }
        
        async function loadSampleProduct() {
            // Load a sample product (Organik Zeytinyaƒüƒ±)
            document.getElementById('product-search').value = 'PRD-GIDA-001';
            await searchProduct();
        }
        
        async function loadProductDetails(productUuid) {
            const container = document.getElementById('product-details-container');
            
            try {
                const response = await fetch(`/K√ºresel/api/products/${productUuid}`);
                const result = await response.json();
                
                if (!result.success) {
                    container.innerHTML = `<div class="error">Error loading product: ${result.message}</div>`;
                    return;
                }
                
                const product = result.data;
                displayProductDetails(product);
                
            } catch (error) {
                container.innerHTML = `<div class="error">Error loading product details: ${error.message}</div>`;
            }
        }
        
        function displayProductDetails(product) {
            const container = document.getElementById('product-details-container');
            
            container.innerHTML = `
                <div class="product-header">
                    <div class="product-image">
                        <img src="${product.product_images && product.product_images.length > 0 ? product.product_images[0] : '/K√ºresel/assets/images/placeholder.jpg'}" 
                             alt="${product.product_name}" 
                             onerror="this.src='/K√ºresel/assets/images/placeholder.jpg'">
                    </div>
                    <div class="product-info">
                        <h1>${product.product_name}</h1>
                        <p><strong>Product Code:</strong> ${product.product_code}</p>
                        <p><strong>Barcode:</strong> ${product.barcode || 'Not specified'}</p>
                        <p><strong>Category:</strong> ${product.category}</p>
                        <p><strong>Brand:</strong> ${product.brand || 'Not specified'}</p>
                        <p><strong>Description:</strong> ${product.description || 'No description available'}</p>
                    </div>
                </div>
                
                <div class="tabs">
                    <button class="tab-button active" onclick="showTab('overview')">Genel Bilgiler</button>
                    <button class="tab-button" onclick="showTab('supply-chain')">Tedarik Zinciri</button>
                    <button class="tab-button" onclick="showTab('impact')">Etki Skorlarƒ±</button>
                    <button class="tab-button" onclick="showTab('certificates')">Sertifikalar</button>
                </div>
                
                <div id="overview" class="tab-content active">
                    <h2>Genel Bilgiler</h2>
                    <div class="info-grid">
                        <div class="info-item">
                            <strong>√úr√ºn Kodu</strong>
                            ${product.product_code}
                        </div>
                        <div class="info-item">
                            <strong>Barkod</strong>
                            ${product.barcode || 'Belirtilmemi≈ü'}
                        </div>
                        <div class="info-item">
                            <strong>Marka</strong>
                            ${product.brand || 'Belirtilmemi≈ü'}
                        </div>
                        <div class="info-item">
                            <strong>Kategori</strong>
                            ${product.category}
                        </div>
                        <div class="info-item">
                            <strong>Alt Kategori</strong>
                            ${product.subcategory || 'Belirtilmemi≈ü'}
                        </div>
                        <div class="info-item">
                            <strong>Men≈üei</strong>
                            ${product.origin_country ? product.origin_country + (product.origin_region ? ' - ' + product.origin_region : '') : 'Belirtilmemi≈ü'}
                        </div>
                        <div class="info-item">
                            <strong>Aƒüƒ±rlƒ±k</strong>
                            ${product.weight ? product.weight + ' kg' : 'Belirtilmemi≈ü'}
                        </div>
                        <div class="info-item">
                            <strong>Hacim</strong>
                            ${product.volume ? product.volume + ' L' : 'Belirtilmemi≈ü'}
                        </div>
                        <div class="info-item">
                            <strong>Paketleme T√ºr√º</strong>
                            ${product.packaging_type || 'Belirtilmemi≈ü'}
                        </div>
                        <div class="info-item">
                            <strong>Raf √ñmr√º</strong>
                            ${product.shelf_life ? product.shelf_life + ' g√ºn' : 'Belirtilmemi≈ü'}
                        </div>
                        <div class="info-item">
                            <strong>Hasat Sezonu</strong>
                            ${product.harvest_season || 'Belirtilmemi≈ü'}
                        </div>
                    </div>
                </div>
                
                <div id="supply-chain" class="tab-content">
                    <h2>Tedarik Zinciri</h2>
                    ${renderSupplyChain(product.supply_chain_steps || [])}
                </div>
                
                <div id="impact" class="tab-content">
                    <h2>Etki Skorlarƒ±</h2>
                    ${renderImpactScores(product.impact_scores)}
                </div>
                
                <div id="certificates" class="tab-content">
                    <h2>Sertifikalar</h2>
                    ${renderCertificates(product.certificates || [])}
                </div>
            `;
        }
        
        function renderSupplyChain(steps) {
            if (!steps || steps.length === 0) {
                return '<p>Tedarik zinciri bilgisi bulunamadƒ±.</p>';
            }
            
            return `
                <div class="supply-chain-steps">
                    ${steps.map(step => `
                        <div class="supply-chain-step">
                            <div class="step-icon">
                                ${getStepIcon(step.step_type)}
                            </div>
                            <div class="step-details">
                                <h3>${step.step_name}</h3>
                                <p><strong>T√ºr:</strong> ${getStepTypeName(step.step_type)}</p>
                                <p><strong>A√ßƒ±klama:</strong> ${step.step_description}</p>
                                <p><strong>Konum:</strong> ${step.address}</p>
                                <p><strong>S√ºre:</strong> ${step.duration_hours} saat</p>
                                <p><strong>ƒ∞≈ü√ßi Sayƒ±sƒ±:</strong> ${step.worker_count}</p>
                                <p><strong>ƒ∞≈ü√ßi Memnuniyeti:</strong> ${step.worker_satisfaction_score}/5</p>
                                <p><strong>Doƒürulama Durumu:</strong> ${step.validation_status} (Skor: ${step.validation_score}/5)</p>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        function renderImpactScores(scores) {
            if (!scores) {
                return '<p>Etki skorlarƒ± bilgisi bulunamadƒ±.</p>';
            }
            
            return `
                <div class="impact-scores-grid">
                    <div class="impact-score-card">
                        <h3>Genel Skor</h3>
                        <div class="impact-score-value">${scores.overall_score}/10</div>
                        <p>Harf Notu: ${scores.overall_grade}</p>
                    </div>
                    <div class="impact-score-card">
                        <h3>√áevresel Etki</h3>
                        <div class="impact-score-value">${scores.environmental_score}/10</div>
                        <p>Karbon Ayak ƒ∞zi: ${scores.carbon_footprint_score}/10</p>
                        <p>Su Kullanƒ±mƒ±: ${scores.water_footprint_score}/10</p>
                    </div>
                    <div class="impact-score-card">
                        <h3>Sosyal Etki</h3>
                        <div class="impact-score-value">${scores.social_score}/10</div>
                        <p>Adil √úcret: ${scores.fair_wages_score}/10</p>
                        <p>√áalƒ±≈üma Ko≈üullarƒ±: ${scores.working_conditions_score}/10</p>
                    </div>
                    <div class="impact-score-card">
                        <h3>≈ûeffaflƒ±k</h3>
                        <div class="impact-score-value">${scores.transparency_score}/10</div>
                        <p>Veri Tamamlƒ±ƒüƒ±: ${scores.data_completeness_score}/10</p>
                    </div>
                </div>
                
                <h3>√áevresel E≈üdeƒüerler</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <strong>Araba Yolculuƒüu</strong>
                        ${scores.equivalent_car_km} km
                    </div>
                    <div class="info-item">
                        <strong>Du≈ü S√ºresi</strong>
                        ${scores.equivalent_shower_minutes} dakika
                    </div>
                    <div class="info-item">
                        <strong>Ev Enerjisi</strong>
                        ${scores.equivalent_home_energy_days} g√ºn
                    </div>
                </div>
            `;
        }
        
        function renderCertificates(certificates) {
            if (!certificates || certificates.length === 0) {
                return '<p>Sertifika bilgisi bulunamadƒ±.</p>';
            }
            
            return `
                <div class="certificates-list">
                    ${certificates.map(cert => `
                        <div class="certificate-card">
                            <h3>${cert.name}</h3>
                            <p><strong>Veren Kurum:</strong> ${cert.issuer}</p>
                            <p><strong>Ge√ßerlilik:</strong> ${cert.validity}</p>
                            <p><strong>Sertifika No:</strong> ${cert.certificate_number}</p>
                            <p><strong>A√ßƒ±klama:</strong> ${cert.description}</p>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Show the selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to the clicked tab button
            event.target.classList.add('active');
        }
        
        function getStepIcon(stepType) {
            const icons = {
                'raw_material': 'üå±',
                'processing': '‚öôÔ∏è',
                'manufacturing': 'üè≠',
                'packaging': 'üì¶',
                'logistics': 'üöö',
                'retail': 'üè™'
            };
            return icons[stepType] || 'üìã';
        }
        
        function getStepTypeName(stepType) {
            const names = {
                'raw_material': 'Ham Madde',
                'processing': 'ƒ∞≈üleme',
                'manufacturing': '√úretim',
                'packaging': 'Ambalajlama',
                'logistics': 'Lojistik',
                'retail': 'Perakende'
            };
            return names[stepType] || stepType;
        }
        
        // Allow search on Enter key
        document.getElementById('product-search').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchProduct();
            }
        });
    </script>
</body>
</html>